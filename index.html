<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RCM Online Tracker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --primary-color: #000080;
            --saffron: #FF9933;
            --white: #FFFFFF;
            --green: #138808;
            --secondary-color: #e3f2fd;
            --text-color: #333;
            --border-radius: 12px;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f4f6f8;
            margin: 0;
            padding: 10px;
            color: var(--text-color);
        }

        .container {
            max-width: 700px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        /* Flag Header */
        .flag-header-container {
            position: relative;
            background: linear-gradient(120deg, var(--saffron) 33%, var(--white) 33%, var(--white) 66%, var(--green) 66%);
            padding: 30px 10px;
            text-align: center;
            border-radius: 12px;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .flag-wave {
            position: absolute; top: 0; left: 0; width: 200%; height: 100%;
            background: linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.3) 50%, rgba(255,255,255,0) 100%);
            transform: skewX(-20deg); animation: flowFlag 3s linear infinite;
        }
        @keyframes flowFlag { 0% { left: -150%; } 100% { left: 150%; } }

        .header-title {
            position: relative; z-index: 2; color: var(--primary-color);
            font-size: 2rem; font-weight: 900; text-transform: uppercase;
            text-shadow: 2px 2px 0px #ffffff; margin: 0;
        }
        .header-subtitle {
            position: relative; z-index: 2; background: rgba(255, 255, 255, 0.8);
            padding: 5px 15px; border-radius: 20px; margin-top: 5px; font-size: 0.9rem; font-weight: bold;
        }

        /* Inputs */
        .date-container {
            background: var(--primary-color); padding: 10px; border-radius: 8px;
            color: white; text-align: center; margin-bottom: 20px;
        }
        .date-container input { padding: 5px; border-radius: 4px; border: none; font-weight: bold; }

        .gases-section { margin-bottom: 15px; border: 1px solid #e0e0e0; border-radius: 8px; overflow: hidden; background: #fff; }
        .section-header { background-color: var(--secondary-color); padding: 10px 15px; display: flex; align-items: center; font-weight: bold; color: var(--primary-color); }
        .letter-icon { background: var(--primary-color); color: white; width: 28px; height: 28px; display: inline-flex; align-items: center; justify-content: center; border-radius: 50%; margin-right: 10px; }
        .sub-task-list { padding: 10px 15px; }
        .task-item { display: flex; align-items: center; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px dashed #eee; justify-content: space-between; }
        .task-item:last-child { border-bottom: none; }
        .task-left { display: flex; align-items: center; flex: 1; }
        .task-item input[type="checkbox"] { width: 18px; height: 18px; margin-right: 10px; }
        .num-input { width: 60px; padding: 5px; border: 2px solid var(--primary-color); border-radius: 5px; text-align: center; font-weight: bold; margin-left: 10px; }
        .task-label { font-size: 0.9rem; cursor: pointer; }
        .task-category { font-size: 0.7rem; color: #ff6f00; font-weight: bold; display: block; }
        .select-target { padding: 5px; border-radius: 5px; border: 1px solid #ccc; }

        /* Buttons */
        .btn-submit {
            background: var(--primary-color); color: white; border: none;
            padding: 15px; width: 100%; border-radius: 50px; font-weight: bold;
            cursor: pointer; margin-top: 15px; transition: 0.3s;
        }
        .btn-submit:hover { opacity: 0.9; }
        .btn-save { background: var(--green); margin-top: 20px; }
        .btn-pdf { background: #d32f2f; margin-top: 10px; }

        #resultArea { display: none; margin-top: 15px; padding: 15px; background: #fff3e0; border-left: 5px solid #ff9800; border-radius: 5px; }
        
        #loadingMsg { text-align: center; color: var(--primary-color); font-weight: bold; display: none; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="container" id="reportContent">
    
    <div class="flag-header-container">
        <div class="flag-wave"></div>
        <h1 class="header-title">üáÆüá≥ ‡§®‡§è ‡§≠‡§æ‡§∞‡§§ ‡§ï‡§æ ‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§£ üáÆüá≥</h1>
        <div class="header-subtitle">Online RCM Cloud Tracker</div>
    </div>

    <div class="date-container" data-html2canvas-ignore="true">
        <label>‡§§‡§æ‡§∞‡•Ä‡§ñ (Date): </label>
        <input type="date" id="reportDate">
        <button id="btnLoad" style="margin-left:10px; padding:5px; cursor:pointer;">Load Data</button>
    </div>
    
    <div id="loadingMsg">üîÑ Connecting to Server...</div>

    <form id="trackerForm">
        
        <div class="gases-section">
            <div class="section-header"><div><span class="letter-icon">G</span> ‡§ó‡•ç‡§∞‡•ã‡§• (Growth)</div></div>
            <div class="sub-task-list">
                <div class="task-item">
                    <div class="task-left"><label class="task-label"><span class="task-category">TARGET</span>‡§Æ‡§π‡§ø‡§®‡•ç‡§Ø‡§æ‡§ö‡•á ‡§ó‡•ç‡§∞‡•ã‡§• ‡§ü‡§æ‡§∞‡•ç‡§ó‡•á‡§ü</label></div>
                    <select id="growthTarget" class="select-target">
                        <option value="0">Normal</option>
                        <option value="25">25% Growth</option>
                        <option value="50">50% Growth</option>
                        <option value="100">100% (Double)</option>
                    </select>
                </div>
                <div class="task-item">
                    <div class="task-left"><label class="task-label"><span class="task-category">SHOW THE PLAN</span>‡§Ü‡§ú ‡§ï‡§ø‡§§‡•Ä ‡§™‡•ç‡§≤‡§æ‡§® (Plan) ‡§¶‡§æ‡§ñ‡§µ‡§≤‡•á?</label></div>
                    <input type="number" id="numPlan" class="num-input" placeholder="0" min="0">
                </div>
                <div class="task-item">
                    <div class="task-left"><input type="checkbox" id="g_vital" class="track-check"><label for="g_vital" class="task-label"><span class="task-category">NEW VITAL</span>‡§®‡§µ‡•Ä‡§® Vital Achiever ‡§∏‡§æ‡§†‡•Ä ‡§ï‡§æ‡§Æ?</label></div>
                </div>
                <div class="task-item">
                    <div class="task-left"><input type="checkbox" id="g_display" class="track-check"><label for="g_display" class="task-label"><span class="task-category">NEW STATION</span>‡§®‡§µ‡•Ä‡§® Display Wall / ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞ ‡§∏‡•Å‡§∞‡•Å?</label></div>
                </div>
            </div>
        </div>

        <div class="gases-section">
            <div class="section-header"><div><span class="letter-icon">A</span> ‡§è‡§ï‡•ç‡§ü‡§ø‡§µ ‡§¶‡§∞ (Active Rate)</div></div>
            <div class="sub-task-list">
                <div class="task-item">
                    <div class="task-left"><label class="task-label"><span class="task-category">CALLING</span>‡§´‡•â‡§≤‡•ã-‡§Ö‡§™ ‡§ï‡•â‡§≤‡•ç‡§∏ (Calls)?</label></div>
                    <input type="number" id="numCalls" class="num-input" placeholder="0" min="0">
                </div>
                <div class="task-item">
                    <div class="task-left"><label class="task-label"><span class="task-category">MEETINGS</span>‡§π‡•ã‡§Æ / ‡§µ‡•á‡§≤‡§ï‡§Æ ‡§Æ‡•Ä‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏?</label></div>
                    <input type="number" id="numMeetings" class="num-input" placeholder="0" min="0">
                </div>
                <div class="task-item">
                    <div class="task-left"><input type="checkbox" id="a_ulp" class="track-check"><label for="a_ulp" class="task-label"><span class="task-category">ULP QUICK</span>ULP (Unique Login Point) ‡§≤‡§ø‡§∏‡•ç‡§ü?</label></div>
                </div>
                <div class="task-item">
                    <div class="task-left"><input type="checkbox" id="a_first_purchase" class="track-check"><label for="a_first_purchase" class="task-label"><span class="task-category">FIRST PURCHASE</span>‡§®‡§µ‡•Ä‡§® ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡•Ä‡§ö‡•Ä ‡§™‡§π‡§ø‡§≤‡•Ä ‡§ñ‡§∞‡•á‡§¶‡•Ä?</label></div>
                </div>
            </div>
        </div>

        <div class="gases-section">
            <div class="section-header"><div><span class="letter-icon">S</span> ‡§∏‡•ç‡§µ‡§Ø‡§Ç ‡§ï‡•Ä ‡§ñ‡§∞‡•Ä‡§¶ (Self Use)</div></div>
            <div class="sub-task-list">
                <div class="task-item">
                    <div class="task-left"><label class="task-label"><span class="task-category">SALES / PV</span>‡§Ü‡§ú‡§ö‡•Ä ‡§µ‡§ø‡§ï‡•ç‡§∞‡•Ä (Selling/Self ID) ‚Çπ?</label></div>
                    <input type="number" id="numPV" class="num-input" placeholder="‚Çπ" min="0">
                </div>
                <div class="task-item">
                    <div class="task-left"><input type="checkbox" id="s_online" class="track-check"><label for="s_online" class="task-label"><span class="task-category">ONLINE ORDER</span>‡§∏‡•ç‡§µ‡§§‡§É‡§ö‡•Ä ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§ë‡§®‡§≤‡§æ‡§à‡§® ‡§ü‡§æ‡§ï‡§≤‡•Ä?</label></div>
                </div>
                <div class="task-item">
                    <div class="task-left"><input type="checkbox" id="s_billing" class="track-check"><label for="s_billing" class="task-label"><span class="task-category">BILLING</span>‡§π‡§æ‡§•‡•ã‡§π‡§æ‡§• (Immediate) ‡§¨‡§ø‡§≤‡§ø‡§Ç‡§ó ‡§ï‡•á‡§≤‡•á?</label></div>
                </div>
            </div>
        </div>

        <div class="gases-section">
            <div class="section-header"><div><span class="letter-icon">E</span> ‡§è‡§ï ‡§∞‡•Ç‡§™ ‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ (Education)</div></div>
            <div class="sub-task-list">
                <div class="task-item">
                    <div class="task-left"><input type="checkbox" id="e_learn" class="track-check"><label for="e_learn" class="task-label"><span class="task-category">LEARNING</span>‡§ó‡•Å‡§∞‡•Å‡§ï‡•Å‡§≤ / ‡§â‡§°‡§æ‡§® ‡§µ‡•ç‡§π‡§ø‡§°‡§ø‡§ì ‡§™‡§æ‡§π‡§ø‡§≤‡§æ?</label></div>
                </div>
                <div class="task-item">
                    <div class="task-left"><input type="checkbox" id="e_teach" class="track-check"><label for="e_teach" class="task-label"><span class="task-category">TEACHING</span>‡§ü‡•Ä‡§Æ ‡§ü‡•ç‡§∞‡•á‡§®‡§ø‡§Ç‡§ó (Duplication) ‡§¶‡§ø‡§≤‡•á?</label></div>
                </div>
            </div>
        </div>

        <div class="gases-section">
            <div class="section-header"><div><span class="letter-icon">S</span> ‡§∏‡§æ‡§Æ‡§æ‡§ú‡§ø‡§ï ‡§¶‡§æ‡§Ø‡§∞‡§æ (Social)</div></div>
            <div class="sub-task-list">
                <div class="task-item">
                    <div class="task-left"><input type="checkbox" id="so_relation" class="track-check"><label for="so_relation" class="task-label"><span class="task-category">RELATION</span>‡§®‡§æ‡§§‡•á‡§µ‡§æ‡§à‡§ï/‡§Æ‡§ø‡§§‡•ç‡§∞ ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï (Non-Business)?</label></div>
                </div>
                <div class="task-item">
                    <div class="task-left"><input type="checkbox" id="so_forgive" class="track-check"><label for="so_forgive" class="task-label"><span class="task-category">FORGIVENESS</span>‡§Æ‡§®‡§æ‡§§‡•Ä‡§≤ ‡§∞‡§æ‡§ó ‡§∏‡•ã‡§°‡•Ç‡§® ‡§¶‡§ø‡§≤‡§æ (Forgiveness)?</label></div>
                </div>
                <div class="task-item">
                    <div class="task-left"><input type="checkbox" id="so_health" class="track-check"><label for="so_health" class="task-label"><span class="task-category">HEALTH/SEVA</span>‡§Ü‡§∞‡•ã‡§ó‡•ç‡§Ø (Health) ‡§ï‡§ø‡§Ç‡§µ‡§æ ‡§∏‡•á‡§µ‡§æ ‡§ï‡§æ‡§∞‡•ç‡§Ø?</label></div>
                </div>
            </div>
        </div>

        <div id="resultArea">
            <strong>üìä AI ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ (Analysis):</strong>
            <p id="analysisText">...</p>
        </div>

    </form>
</div>

<div class="container" style="background: transparent; box-shadow: none; margin-top: 0; padding-top: 0;">
    <button type="button" class="btn-submit btn-save" id="btnSaveData">‚òÅÔ∏è Save Data to Cloud</button>
    <button type="button" class="btn-submit" id="btnCalc">üîç Calculate Analysis</button>
    <button type="button" class="btn-submit btn-pdf" id="btnDownloadPDF">üì• Download PDF Report</button>
</div>

<script type="module">
  // Import Firebase
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // Configuration provided by user
  const firebaseConfig = {
    apiKey: "AIzaSyCsgwBoTiEtSNJ2xMm4di0F0GiAtFxoswM",
    authDomain: "order-b15a8.firebaseapp.com",
    projectId: "order-b15a8",
    storageBucket: "order-b15a8.firebasestorage.app",
    messagingSenderId: "614443594278",
    appId: "1:614443594278:web:e31715b6ee592b30326ce7"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // UI Elements
  const dateInput = document.getElementById('reportDate');
  const loadingMsg = document.getElementById('loadingMsg');
  
  // Set Today's Date
  dateInput.valueAsDate = new Date();

  // --- SAVE DATA FUNCTION ---
  window.saveToFirebase = async function() {
    const dateVal = dateInput.value;
    if(!dateVal) { alert("Please select a date!"); return; }

    loadingMsg.style.display = 'block';
    loadingMsg.innerText = "Saving to Cloud...";

    const data = {
        target: document.getElementById('growthTarget').value,
        plans: document.getElementById('numPlan').value,
        g_vital: document.getElementById('g_vital').checked,
        g_display: document.getElementById('g_display').checked,
        
        calls: document.getElementById('numCalls').value,
        meetings: document.getElementById('numMeetings').value,
        a_ulp: document.getElementById('a_ulp').checked,
        a_first_purchase: document.getElementById('a_first_purchase').checked,
        
        pv: document.getElementById('numPV').value,
        s_online: document.getElementById('s_online').checked,
        s_billing: document.getElementById('s_billing').checked,
        
        e_learn: document.getElementById('e_learn').checked,
        e_teach: document.getElementById('e_teach').checked,
        
        so_relation: document.getElementById('so_relation').checked,
        so_forgive: document.getElementById('so_forgive').checked,
        so_health: document.getElementById('so_health').checked,
        
        lastUpdated: new Date()
    };

    try {
        // Saving to collection 'rcm_daily_tracker', document ID = date (e.g. '2025-10-04')
        await setDoc(doc(db, "rcm_daily_tracker", dateVal), data);
        alert("‚úÖ Data Saved Successfully Online!");
    } catch (error) {
        console.error("Error saving document: ", error);
        alert("Error saving data: " + error.message);
    } finally {
        loadingMsg.style.display = 'none';
    }
  }

  // --- LOAD DATA FUNCTION ---
  window.loadFromFirebase = async function() {
    const dateVal = dateInput.value;
    if(!dateVal) return;

    loadingMsg.style.display = 'block';
    loadingMsg.innerText = "Loading from Cloud...";
    
    // Hide previous results
    document.getElementById('resultArea').style.display = 'none';

    try {
        const docRef = doc(db, "rcm_daily_tracker", dateVal);
        const docSnap = await getDoc(docRef);

        if (docSnap.exists()) {
            const data = docSnap.data();
            
            // Populate fields
            document.getElementById('growthTarget').value = data.target || 0;
            document.getElementById('numPlan').value = data.plans || "";
            document.getElementById('g_vital').checked = data.g_vital || false;
            document.getElementById('g_display').checked = data.g_display || false;
            
            document.getElementById('numCalls').value = data.calls || "";
            document.getElementById('numMeetings').value = data.meetings || "";
            document.getElementById('a_ulp').checked = data.a_ulp || false;
            document.getElementById('a_first_purchase').checked = data.a_first_purchase || false;
            
            document.getElementById('numPV').value = data.pv || "";
            document.getElementById('s_online').checked = data.s_online || false;
            document.getElementById('s_billing').checked = data.s_billing || false;
            
            document.getElementById('e_learn').checked = data.e_learn || false;
            document.getElementById('e_teach').checked = data.e_teach || false;
            
            document.getElementById('so_relation').checked = data.so_relation || false;
            document.getElementById('so_forgive').checked = data.so_forgive || false;
            document.getElementById('so_health').checked = data.so_health || false;
            
            console.log("Data loaded for", dateVal);
        } else {
            // No data found for this date
            document.getElementById('trackerForm').reset();
            document.getElementById('growthTarget').value = "0";
            console.log("No such document!");
        }
    } catch (error) {
        console.error("Error getting document:", error);
        alert("Error loading data. Check internet connection.");
    } finally {
        loadingMsg.style.display = 'none';
    }
  }

  // Attach functions to buttons
  document.getElementById('btnSaveData').addEventListener('click', window.saveToFirebase);
  document.getElementById('btnLoad').addEventListener('click', window.loadFromFirebase);
  document.getElementById('reportDate').addEventListener('change', window.loadFromFirebase);

  // Initial load
  window.loadFromFirebase();

</script>

<script>
    // --- NON-FIREBASE FUNCTIONS (Calculation & PDF) ---
    
    document.getElementById('btnCalc').addEventListener('click', calculateAndShow);
    document.getElementById('btnDownloadPDF').addEventListener('click', downloadPDF);

    function calculateAndShow() {
        let score = 0;
        let plans = parseInt(document.getElementById('numPlan').value) || 0;
        let calls = parseInt(document.getElementById('numCalls').value) || 0;
        let meetings = parseInt(document.getElementById('numMeetings').value) || 0;
        let pv = parseInt(document.getElementById('numPV').value) || 0;

        // Scoring Logic
        score += Math.min(plans * 10, 30);
        score += Math.min(meetings * 15, 30);
        score += Math.min(calls * 2, 10);
        score += Math.min(pv / 100, 10);

        let checkboxes = document.querySelectorAll('.track-check');
        let checkedCount = 0;
        checkboxes.forEach(box => { if(box.checked) checkedCount++; });
        score += (checkedCount * 3);

        if(score > 100) score = 100;

        let feedback = `Total Cloud Score: <strong style="font-size:1.3rem; color:${score < 50 ? 'red' : 'green'}">${Math.round(score)}/100</strong><br><br>`;
        
        if(plans === 0 && meetings === 0) feedback += "üî¥ <strong>Action:</strong> ‡§´‡§ø‡§≤‡•ç‡§° ‡§µ‡§∞‡•ç‡§ï ‡§ù‡§ø‡§∞‡•ã ‡§Ü‡§π‡•á.<br>";
        else feedback += "üü¢ <strong>Good:</strong> ‡§´‡§ø‡§≤‡•ç‡§° ‡§µ‡§∞‡•ç‡§ï ‡§ö‡§æ‡§≤‡•Ç ‡§Ü‡§π‡•á.<br>";

        if(score > 80) feedback += "üèÜ <strong>Victory:</strong> ‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä '‡§®‡§è ‡§≠‡§æ‡§∞‡§§ ‡§ï‡§æ ‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§£' ‡§ï‡§∞‡§§ ‡§Ü‡§π‡§æ‡§§!";
        else if(score < 40) feedback += "‚ö†Ô∏è <strong>Alert:</strong> ‡§ï‡§æ‡§Æ ‡§µ‡§æ‡§¢‡§µ‡§æ, ‡§®‡§æ‡§π‡•Ä‡§§‡§∞ ‡§Æ‡§æ‡§ó‡•á ‡§™‡§°‡§æ‡§≤.";

        document.getElementById('analysisText').innerHTML = feedback;
        document.getElementById('resultArea').style.display = 'block';
    }

    function downloadPDF() {
        calculateAndShow();
        const element = document.getElementById('reportContent');
        const dateVal = document.getElementById('reportDate').value;
        const opt = {
            margin: 0.3,
            filename: `RCM_Cloud_Report_${dateVal}.pdf`,
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2 },
            jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
        };
        html2pdf().set(opt).from(element).save();
    }
</script>

</body>
</html>
