<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GASES Gurumantra Tracker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #000080, #1a237e);
            --secondary-bg: #f8f9fa;
            --card-shadow: 0 10px 20px rgba(0,0,0,0.08);
            --accent-color: #ff6f00;
            --text-dark: #2c3e50;
        }

        body { font-family: 'Segoe UI', 'Roboto', sans-serif; background-color: #eceff1; margin: 0; padding: 15px; color: var(--text-dark); }
        .container { max-width: 750px; margin: 0 auto; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); overflow: hidden; }

        /* --- NEW: ATTRACTIVE TIRKAS (SLANTED) HEADER --- */
        .flag-header-wrapper {
            margin: -25px -25px 30px -25px; /* Full width */
            padding-bottom: 20px;
            overflow: hidden;
            filter: drop-shadow(0 10px 10px rgba(0,0,0,0.2));
        }

        .flag-header-container {
            position: relative;
            /* ‡§§‡§ø‡§∞‡§Ç‡§ó‡§æ (Tirkas Gradient) */
            background: linear-gradient(135deg, #FF9933 25%, #FFFFFF 50%, #138808 75%);
            padding: 50px 20px 70px 20px;
            text-align: center;
            /* ‡§§‡§ø‡§∞‡§ï‡§∏ ‡§Ü‡§ï‡§æ‡§∞ (Slanted Shape) */
            transform: skewY(-4deg);
            transform-origin: top left;
            border-bottom: 5px solid #d4af37; /* Gold Border */
        }

        /* ‡•≤‡§®‡§ø‡§Æ‡•á‡§∂‡§® (Waving Effect) */
        .flag-wave {
            position: absolute; top: 0; left: -100%; width: 200%; height: 100%;
            background: linear-gradient(110deg, rgba(255,255,255,0) 30%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0) 70%);
            animation: shine 3s infinite linear;
            pointer-events: none;
        }

        @keyframes shine { 
            0% { transform: translateX(0); } 
            100% { transform: translateX(100%); } 
        }

        /* ‡§Æ‡§ú‡§ï‡•Ç‡§∞ ‡§∏‡§∞‡§≥ ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä (Un-skew text) */
        .header-content {
            transform: skewY(4deg); /* Counter skew */
            position: relative; z-index: 5;
        }

        .header-title { 
            color: #000080; 
            font-size: 2.5rem; 
            font-weight: 900; 
            text-transform: uppercase; 
            text-shadow: 3px 3px 0px #fff, 0px 0px 15px rgba(255,255,255,0.8); 
            margin: 0; 
            letter-spacing: 1px;
            font-family: 'Arya', sans-serif; /* Indian style font fallback */
        }
        
        .header-subtitle { 
            background: #000080; 
            color: white;
            padding: 5px 20px; 
            border-radius: 30px; 
            margin-top: 5px; 
            font-size: 1.1rem; 
            font-weight: bold; 
            display: inline-block; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            border: 2px solid #fff;
        }

        /* --- COUNTDOWN --- */
        .countdown-box {
            background: linear-gradient(to right, #d32f2f, #c62828); color: white; text-align: center; padding: 12px; border-radius: 10px; margin-bottom: 25px; font-weight: bold; font-size: 1.1rem;
            box-shadow: 0 4px 15px rgba(211, 47, 47, 0.3); letter-spacing: 0.5px;
        }

        /* --- REST OF THE CSS (Original) --- */
        .business-section {
            background: #fff; border-radius: 15px; padding: 20px; margin-bottom: 25px;
            box-shadow: var(--card-shadow); border-top: 5px solid #ffca28;
        }
        .business-title { color: #f57f17; font-weight: 800; text-align: center; margin-bottom: 15px; font-size: 1.2rem; text-transform: uppercase; letter-spacing: 1px; }
        
        .biz-grid-row { display: grid; grid-template-columns: 1.5fr 1fr 1fr 1.2fr; gap: 8px; align-items: center; margin-bottom: 10px; }
        .biz-head { font-size: 0.8rem; font-weight: 700; text-align: center; color: #7f8c8d; text-transform: uppercase; }
        .biz-label { font-weight: 700; font-size: 0.95rem; color: #2c3e50; }
        .biz-input { width: 100%; padding: 8px; border: 1px solid #e0e0e0; border-radius: 8px; text-align: center; font-weight: bold; font-size: 1rem; transition: border 0.3s; }
        .biz-input:focus { border-color: #000080; outline: none; }
        .biz-readonly { background: #f1f2f6; color: #7f8c8d; border: 1px solid #dcdcdc; } 
        .growth-display { font-size: 0.85rem; font-weight: 800; text-align: center; padding: 5px; border-radius: 6px; }
        .pos { color: #2e7d32; background: #e8f5e9; } 
        .neg { color: #c62828; background: #ffebee; }

        .gases-card {
            background: white; border-radius: 15px; margin-bottom: 20px; overflow: hidden;
            box-shadow: var(--card-shadow); transition: transform 0.3s ease; border: 1px solid #f0f0f0;
        }
        .gases-card:hover { transform: translateY(-3px); }
        .card-header { background: var(--primary-gradient); padding: 12px 20px; color: white; display: flex; align-items: center; }
        .card-icon { background: rgba(255,255,255,0.2); width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem; margin-right: 15px; }
        .card-title { font-weight: bold; font-size: 1.1rem; letter-spacing: 0.5px; }
        .card-body { padding: 15px 20px; }
        .task-item { display: flex; align-items: center; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #f0f0f0; }
        .task-item:last-child { border-bottom: none; }
        .task-label { font-size: 0.95rem; color: #455a64; font-weight: 500; cursor: pointer; flex: 1; }
        .task-sub { font-size: 0.75rem; color: var(--accent-color); font-weight: bold; display: block; margin-bottom: 2px; text-transform: uppercase; }
        .styled-checkbox { width: 22px; height: 22px; cursor: pointer; accent-color: #000080; margin-right: 15px; }
        .styled-input { width: 80px; padding: 6px; border: 2px solid #e0e0e0; border-radius: 8px; text-align: center; font-weight: bold; color: #000080; }
        .styled-input:focus { border-color: var(--accent-color); outline: none; }
        .styled-select { padding: 6px; border-radius: 6px; border: 1px solid #ccc; font-weight: bold; color: #333; }

        .plan-section { border-top: 4px solid #ff6f00; }
        .plan-header { background: linear-gradient(135deg, #ff6f00, #ff8f00); }
        .plan-row { display: flex; gap: 10px; margin-bottom: 10px; }
        .plan-input-field { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-family: inherit; font-size: 0.95rem; }
        .btn-add { background: #ff6f00; color: white; border: none; padding: 8px 20px; border-radius: 30px; font-weight: bold; cursor: pointer; font-size: 0.9rem; margin-top: 10px; box-shadow: 0 4px 10px rgba(255, 111, 0, 0.3); }

        #resultArea { display: none; margin-top: 30px; background: #fff; border-radius: 15px; border: 2px solid #000080; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .analysis-header { background: #000080; color: white; padding: 15px; text-align: center; font-weight: bold; font-size: 1.2rem; }
        .analysis-content { padding: 20px; font-size: 0.95rem; line-height: 1.6; color: #333; }
        .analysis-score { font-size: 1.5rem; color: #000080; font-weight: 900; text-align: center; margin-bottom: 15px; display: block; }
        
        .btn-group { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }
        .btn-main { padding: 15px; border: none; border-radius: 10px; color: white; font-weight: bold; font-size: 1rem; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.15); transition: transform 0.2s; }
        .btn-main:active { transform: scale(0.98); }
        .btn-save { background: linear-gradient(to right, #2e7d32, #43a047); }
        .btn-calc { background: linear-gradient(to right, #000080, #1a237e); }
        .btn-wa { background: #25D366; }
        .btn-pdf { background: #d32f2f; }

        .date-picker-styled { padding: 8px; border-radius: 8px; border: 1px solid #ccc; font-weight: bold; }
        .loader { text-align: center; color: #000080; font-weight: bold; display: none; margin: 10px 0; }
    </style>
</head>
<body>

<div class="container" id="reportContent">
    
    <div class="flag-header-wrapper">
        <div class="flag-header-container">
            <div class="flag-wave"></div>
            <div class="header-content">
                <h1 class="header-title">üáÆüá≥ GASES ‡§ó‡•Å‡§∞‡•Å‡§Æ‡§Ç‡§§‡•ç‡§∞ üáÆüá≥</h1>
                <div class="header-subtitle">RCM ‡§Ø‡§∂‡§æ‡§ö‡§æ ‡§Æ‡§π‡§æ‡§Æ‡§æ‡§∞‡•ç‡§ó</div>
            </div>
        </div>
    </div>

    <div class="countdown-box" id="countdownTimer">
        ‚è≥ Mission March 2026 Loading...
    </div>

    <div style="text-align:center; margin-bottom:20px;" data-html2canvas-ignore="true">
        <label><b>‡§§‡§æ‡§∞‡•Ä‡§ñ ‡§®‡§ø‡§µ‡§°‡§æ:</b> </label>
        <input type="date" id="reportDate" class="date-picker-styled">
        <button onclick="window.loadFromFirebase()" style="padding:8px 15px; border-radius:8px; border:none; background:#eee; cursor:pointer; font-weight:bold;">üîÑ Load Data</button>
    </div>
    <div id="loadingMsg" class="loader">üîÑ ‡§ï‡•ç‡§≤‡§æ‡§â‡§° ‡§µ‡§∞‡•Ç‡§® ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä ‡§ò‡•á‡§§ ‡§Ü‡§π‡•á...</div>

    <form id="trackerForm">

        <div class="business-section">
            <div class="business-title">üìä ‡§¨‡§ø‡§ù‡§®‡•á‡§∏ ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü (PV Comparison)</div>
            <div class="biz-grid-row">
                <div class="biz-head" style="text-align:left;">CATEGORY</div>
                <div class="biz-head">TODAY</div>
                <div class="biz-head">YESTERDAY</div>
                <div class="biz-head">GROWTH</div>
            </div>
            <div class="biz-grid-row">
                <div class="biz-label">Total Group PV</div>
                <input type="number" id="totalToday" class="biz-input" placeholder="0" oninput="calcGrowth()">
                <input type="number" id="totalYest" class="biz-input biz-readonly" placeholder="0" readonly>
                <div id="gTotal" class="growth-display">-</div>
            </div>
            <div class="biz-grid-row">
                <div class="biz-label" style="color:green">Leg A (Power)</div>
                <input type="number" id="legAToday" class="biz-input" placeholder="0" oninput="calcGrowth()">
                <input type="number" id="legAYest" class="biz-input biz-readonly" placeholder="0" readonly>
                <div id="gLegA" class="growth-display">-</div>
            </div>
            <div class="biz-grid-row">
                <div class="biz-label" style="color:#d84315">Leg B (Second)</div>
                <input type="number" id="legBToday" class="biz-input" placeholder="0" oninput="calcGrowth()">
                <input type="number" id="legBYest" class="biz-input biz-readonly" placeholder="0" readonly>
                <div id="gLegB" class="growth-display">-</div>
            </div>
        </div>
        
        <div class="gases-card">
            <div class="card-header">
                <div class="card-icon">G</div>
                <div class="card-title">‡§ó‡•ç‡§∞‡•ã‡§• (Growth Activities)</div>
            </div>
            <div class="card-body">
                <div class="task-item">
                    <label class="task-label"><span class="task-sub">TARGET</span>‡§Æ‡§π‡§ø‡§®‡•ç‡§Ø‡§æ‡§ö‡•á ‡§ó‡•ç‡§∞‡•ã‡§• ‡§ü‡§æ‡§∞‡•ç‡§ó‡•á‡§ü</label>
                    <select id="growthTarget" class="styled-select">
                        <option value="0">Normal</option>
                        <option value="25">25% Growth</option>
                        <option value="50">50% Growth</option>
                        <option value="100">100% Double</option>
                    </select>
                </div>
                <div class="task-item">
                    <label class="task-label"><span class="task-sub">ACTION</span>‡§Ü‡§ú ‡§™‡•ç‡§≤‡§æ‡§® ‡§¶‡§æ‡§ñ‡§µ‡§≤‡•á (Plan Show)</label>
                    <input type="number" id="numPlan" class="styled-input" placeholder="0">
                </div>
                <div class="task-item">
                    <label class="task-label" for="g_vital"><span class="task-sub">STRUCTURE</span>‡§®‡§µ‡•Ä‡§® Vital (Openner/Eagle) ‡§∏‡§æ‡§†‡•Ä ‡§ï‡§æ‡§Æ</label>
                    <input type="checkbox" id="g_vital" class="styled-checkbox">
                </div>
                <div class="task-item">
                    <label class="task-label" for="g_display"><span class="task-sub">EXPANSION</span>‡§®‡§µ‡•Ä‡§® ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞ / ‡§°‡§ø‡§∏‡•ç‡§™‡•ç‡§≤‡•á ‡§µ‡•â‡§≤ ‡§ì‡§™‡§®‡§ø‡§Ç‡§ó</label>
                    <input type="checkbox" id="g_display" class="styled-checkbox">
                </div>
            </div>
        </div>

        <div class="gases-card">
            <div class="card-header">
                <div class="card-icon">A</div>
                <div class="card-title">‡§è‡§ï‡•ç‡§ü‡§ø‡§µ (Active Rate)</div>
            </div>
            <div class="card-body">
                <div class="task-item">
                    <label class="task-label"><span class="task-sub">FOLLOW-UP</span>‡§ï‡•â‡§≤‡§ø‡§Ç‡§ó (Calls Made)</label>
                    <input type="number" id="numCalls" class="styled-input" placeholder="0">
                </div>
                <div class="task-item">
                    <label class="task-label"><span class="task-sub">EVENT</span>‡§Æ‡•Ä‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏ (Home/Welcome)</label>
                    <input type="number" id="numMeetings" class="styled-input" placeholder="0">
                </div>
                <div class="task-item">
                    <label class="task-label" for="a_ulp"><span class="task-sub">TECHNICAL</span>ULP (Unique Login) ‡§ö‡•á‡§ï ‡§ï‡•á‡§≤‡•Ä</label>
                    <input type="checkbox" id="a_ulp" class="styled-checkbox">
                </div>
                <div class="task-item">
                    <label class="task-label" for="a_zero"><span class="task-sub">ACTIVATION</span>Zero ID (‡§ñ‡§∞‡•á‡§¶‡•Ä ‡§®‡§∏‡§≤‡•á‡§≤‡•á) ‡§è‡§ï‡•ç‡§ü‡§ø‡§µ ‡§ï‡•á‡§≤‡•á?</label>
                    <input type="checkbox" id="a_zero" class="styled-checkbox">
                </div>
            </div>
        </div>

        <div class="gases-card">
            <div class="card-header">
                <div class="card-icon">S</div>
                <div class="card-title">‡§∏‡•ç‡§µ‡§§‡§É‡§ö‡•Ä ‡§ñ‡§∞‡•á‡§¶‡•Ä (Self Use & Sale)</div>
            </div>
            <div class="card-body">
                <div class="task-item">
                    <label class="task-label"><span class="task-sub">TURNOVER</span>‡§µ‡§ø‡§ï‡•ç‡§∞‡•Ä / ‡§∏‡•á‡§≤‡•ç‡§´ PV (‚Çπ)</label>
                    <input type="number" id="numPV" class="styled-input" placeholder="‚Çπ">
                </div>
                <div class="task-item">
                    <label class="task-label" for="s_diamond"><span class="task-sub">CONSISTENCY</span>‡§°‡§æ‡§Ø‡§Æ‡§Ç‡§° ‡§ï‡•ç‡§≤‡§¨ / ‡§∏‡§æ‡§§‡§§‡•ç‡§Ø‡§™‡•Ç‡§∞‡•ç‡§£ ‡§ñ‡§∞‡•á‡§¶‡•Ä</label>
                    <input type="checkbox" id="s_diamond" class="styled-checkbox">
                </div>
                <div class="task-item">
                    <label class="task-label" for="s_online"><span class="task-sub">DIGITAL</span>‡§∏‡•ç‡§µ‡§§‡§É‡§ö‡•Ä ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§ë‡§®‡§≤‡§æ‡§à‡§® ‡§ü‡§æ‡§ï‡§≤‡•Ä</label>
                    <input type="checkbox" id="s_online" class="styled-checkbox">
                </div>
                <div class="task-item">
                    <label class="task-label" for="s_billing"><span class="task-sub">DISCIPLINE</span>‡§≤‡§ó‡•á‡§ö ‡§¨‡§ø‡§≤‡§ø‡§Ç‡§ó (Immediate Billing) ‡§ï‡•á‡§≤‡•á</label>
                    <input type="checkbox" id="s_billing" class="styled-checkbox">
                </div>
            </div>
        </div>

        <div class="gases-card">
            <div class="card-header">
                <div class="card-icon">E</div>
                <div class="card-title">‡§∂‡§ø‡§ï‡•ç‡§∑‡§£ (Education)</div>
            </div>
            <div class="card-body">
                <div class="task-item">
                    <label class="task-label" for="e_learn"><span class="task-sub">LEARN</span>‡§ó‡•Å‡§∞‡•Å‡§ï‡•Å‡§≤ / ‡§â‡§°‡§æ‡§® ‡§µ‡•ç‡§π‡§ø‡§°‡§ø‡§ì ‡§™‡§æ‡§π‡§ø‡§≤‡§æ</label>
                    <input type="checkbox" id="e_learn" class="styled-checkbox">
                </div>
                <div class="task-item">
                    <label class="task-label" for="e_book"><span class="task-sub">MINDSET</span>‡§™‡•Å‡§∏‡•ç‡§§‡§ï ‡§µ‡§æ‡§ö‡§® (Book Reading 30 Min)</label>
                    <input type="checkbox" id="e_book" class="styled-checkbox">
                </div>
                <div class="task-item">
                    <label class="task-label" for="e_teach"><span class="task-sub">DUPLICATION</span>‡§ü‡•Ä‡§Æ ‡§ü‡•ç‡§∞‡•á‡§®‡§ø‡§Ç‡§ó (‡§∂‡§ø‡§ï‡§≤‡•á‡§≤‡•á ‡§∂‡§ø‡§ï‡§µ‡§≤‡•á)</label>
                    <input type="checkbox" id="e_teach" class="styled-checkbox">
                </div>
            </div>
        </div>

        <div class="gases-card">
            <div class="card-header">
                <div class="card-icon">S</div>
                <div class="card-title">‡§∏‡§æ‡§Æ‡§æ‡§ú‡§ø‡§ï (Social & Values)</div>
            </div>
            <div class="card-body">
                <div class="task-item">
                    <label class="task-label" for="so_relation"><span class="task-sub">RELATION</span>‡§®‡§æ‡§§‡•á‡§µ‡§æ‡§à‡§ï/‡§Æ‡§ø‡§§‡•ç‡§∞ ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï</label>
                    <input type="checkbox" id="so_relation" class="styled-checkbox">
                </div>
                <div class="task-item">
                    <label class="task-label" for="so_forgive"><span class="task-sub">PEACE</span>‡§Æ‡§®‡§æ‡§§‡•Ä‡§≤ ‡§∞‡§æ‡§ó ‡§∏‡•ã‡§°‡§≤‡§æ / ‡§Æ‡§æ‡§´‡•Ä (Forgiveness)</label>
                    <input type="checkbox" id="so_forgive" class="styled-checkbox">
                </div>
                <div class="task-item">
                    <label class="task-label" for="so_health"><span class="task-sub">SEVA</span>‡§Ü‡§∞‡•ã‡§ó‡•ç‡§Ø / ‡§∏‡•á‡§µ‡§æ ‡§ï‡§æ‡§∞‡•ç‡§Ø</label>
                    <input type="checkbox" id="so_health" class="styled-checkbox">
                </div>
            </div>
        </div>

        <div class="gases-card plan-section">
            <div class="card-header plan-header">
                <div class="card-icon">üìù</div>
                <div class="card-title">‡§â‡§¶‡•ç‡§Ø‡§æ‡§ö‡•á ‡§®‡§ø‡§Ø‡•ã‡§ú‡§® (Planning)</div>
            </div>
            <div class="card-body" style="text-align: center;">
                <div id="planContainer">
                    </div>
                <button type="button" class="btn-add" onclick="addPlanField()">+ ‡§®‡§µ‡•Ä‡§® ‡§ï‡§æ‡§Æ ‡§ú‡•ã‡§°‡§æ</button>
            </div>
        </div>

        <div id="resultArea">
            <div class="analysis-header">ü§ñ Professional Analysis Report</div>
            <div class="analysis-content">
                <span id="scoreDisplay" class="analysis-score"></span>
                <div id="detailedReport"></div>
            </div>
        </div>

    </form>
</div>

<div class="container" style="background: transparent; box-shadow: none; margin-top: 0; padding-top: 0;">
    <div class="btn-group">
        <button type="button" class="btn-main btn-save" onclick="window.saveToFirebase()">‚òÅÔ∏è Save Data to Cloud</button>
        <button type="button" class="btn-main btn-calc" onclick="generateDetailedReport()">üìä Generate Analysis Report</button>
        <button type="button" class="btn-main btn-wa" onclick="shareToWhatsApp()">üì≤ WhatsApp Share</button>
        <button type="button" class="btn-main btn-pdf" onclick="downloadPDF()">üì• Download Professional PDF</button>
    </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCsgwBoTiEtSNJ2xMm4di0F0GiAtFxoswM",
    authDomain: "order-b15a8.firebaseapp.com",
    projectId: "order-b15a8",
    storageBucket: "order-b15a8.firebasestorage.app",
    messagingSenderId: "614443594278",
    appId: "1:614443594278:web:e31715b6ee592b30326ce7"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const dateInput = document.getElementById('reportDate');
  const loadingMsg = document.getElementById('loadingMsg');
  
  dateInput.valueAsDate = new Date();

  window.onload = function() {
    window.loadFromFirebase();
    updateCountdown();
  };

  window.saveToFirebase = async function() {
    const dateVal = dateInput.value;
    if(!dateVal) { alert("Date required!"); return; }
    loadingMsg.style.display = 'block';

    let plansList = [];
    document.querySelectorAll('.plan-input-field').forEach(i => {
        if(i.value.trim()) plansList.push(i.value.trim());
    });

    const data = {
        totalToday: document.getElementById('totalToday').value,
        legAToday: document.getElementById('legAToday').value,
        legBToday: document.getElementById('legBToday').value,
        target: document.getElementById('growthTarget').value,
        plans: document.getElementById('numPlan').value,
        g_vital: document.getElementById('g_vital').checked,
        g_display: document.getElementById('g_display').checked,
        calls: document.getElementById('numCalls').value,
        meetings: document.getElementById('numMeetings').value,
        a_ulp: document.getElementById('a_ulp').checked,
        a_zero: document.getElementById('a_zero').checked,
        pv: document.getElementById('numPV').value,
        s_diamond: document.getElementById('s_diamond').checked,
        s_online: document.getElementById('s_online').checked,
        s_billing: document.getElementById('s_billing').checked,
        e_learn: document.getElementById('e_learn').checked,
        e_book: document.getElementById('e_book').checked,
        e_teach: document.getElementById('e_teach').checked,
        so_relation: document.getElementById('so_relation').checked,
        so_forgive: document.getElementById('so_forgive').checked,
        so_health: document.getElementById('so_health').checked,
        plansList: plansList,
        lastUpdated: new Date()
    };

    try {
        await setDoc(doc(db, "rcm_pro_tracker", dateVal), data);
        alert("‚úÖ Data Saved Successfully!");
    } catch (error) { alert(error.message); } 
    finally { loadingMsg.style.display = 'none'; }
  }

  window.loadFromFirebase = async function() {
    const dateVal = dateInput.value;
    if(!dateVal) return;
    loadingMsg.style.display = 'block';
    
    const current = new Date(dateVal);
    current.setDate(current.getDate() - 1);
    const yestVal = current.toISOString().split('T')[0];

    try {
        const docRef = doc(db, "rcm_pro_tracker", dateVal);
        const docSnap = await getDoc(docRef);
        
        document.getElementById('planContainer').innerHTML = ""; 

        if (docSnap.exists()) {
            const d = docSnap.data();
            document.getElementById('totalToday').value = d.totalToday || "";
            document.getElementById('legAToday').value = d.legAToday || "";
            document.getElementById('legBToday').value = d.legBToday || "";
            document.getElementById('growthTarget').value = d.target || 0;
            document.getElementById('numPlan').value = d.plans || "";
            document.getElementById('g_vital').checked = d.g_vital || false;
            document.getElementById('g_display').checked = d.g_display || false;
            document.getElementById('numCalls').value = d.calls || "";
            document.getElementById('numMeetings').value = d.meetings || "";
            document.getElementById('a_ulp').checked = d.a_ulp || false;
            document.getElementById('a_zero').checked = d.a_zero || false;
            document.getElementById('numPV').value = d.pv || "";
            document.getElementById('s_diamond').checked = d.s_diamond || false;
            document.getElementById('s_online').checked = d.s_online || false;
            document.getElementById('s_billing').checked = d.s_billing || false;
            document.getElementById('e_learn').checked = d.e_learn || false;
            document.getElementById('e_book').checked = d.e_book || false;
            document.getElementById('e_teach').checked = d.e_teach || false;
            document.getElementById('so_relation').checked = d.so_relation || false;
            document.getElementById('so_forgive').checked = d.so_forgive || false;
            document.getElementById('so_health').checked = d.so_health || false;
            
            if(d.plansList && d.plansList.length) {
                d.plansList.forEach(p => window.addPlanField(p));
            } else { window.addPlanField(); }
        } else {
            document.getElementById('trackerForm').reset();
            document.getElementById('totalToday').value = "";
            window.addPlanField();
        }

        const yRef = doc(db, "rcm_pro_tracker", yestVal);
        const ySnap = await getDoc(yRef);
        if(ySnap.exists()) {
            document.getElementById('totalYest').value = ySnap.data().totalToday || 0;
            document.getElementById('legAYest').value = ySnap.data().legAToday || 0;
            document.getElementById('legBYest').value = ySnap.data().legBToday || 0;
        } else {
            document.getElementById('totalYest').value = 0;
            document.getElementById('legAYest').value = 0;
            document.getElementById('legBYest').value = 0;
        }
        window.calcGrowth();
    } catch (e) { console.error(e); } 
    finally { loadingMsg.style.display = 'none'; }
  }

  document.getElementById('btnLoad').addEventListener('click', window.loadFromFirebase);
  document.getElementById('reportDate').addEventListener('change', window.loadFromFirebase);
</script>

<script>
    function addPlanField(val = "") {
        const div = document.createElement('div');
        div.className = 'plan-row';
        div.innerHTML = `<input type="text" class="plan-input-field" value="${val}" placeholder="Task here...">
                         <button type="button" onclick="this.parentElement.remove()" style="color:red;border:none;background:none;font-weight:bold;">X</button>`;
        document.getElementById('planContainer').appendChild(div);
    }

    function updateCountdown() {
        const days = Math.floor((new Date("March 31, 2026").getTime() - new Date().getTime()) / (1000 * 60 * 60 * 24));
        document.getElementById("countdownTimer").innerText = `‚è≥ Mission March 2026: ‡§´‡§ï‡•ç‡§§ ${days} ‡§¶‡§ø‡§µ‡§∏ ‡§¨‡§æ‡§ï‡•Ä!`;
    }

    window.calcGrowth = function() {
        doCalc('totalToday', 'totalYest', 'gTotal');
        doCalc('legAToday', 'legAYest', 'gLegA');
        doCalc('legBToday', 'legBYest', 'gLegB');
    }
    function doCalc(t, y, r) {
        let T = parseFloat(document.getElementById(t).value)||0;
        let Y = parseFloat(document.getElementById(y).value)||0;
        let el = document.getElementById(r);
        let d = T-Y;
        let cls = d>=0 ? "pos":"neg";
        if(Y>0) {
             let p = ((d/Y)*100).toFixed(1);
             el.innerHTML = `<span class="${cls} growth-display" style="display:block">${d>0?'+':''}${d} (${p}%)</span>`;
        } else {
            el.innerHTML = T>0 ? `<span class="pos growth-display">+${T}</span>` : "-";
        }
    }

    function generateDetailedReport() {
        let plans = parseInt(document.getElementById('numPlan').value) || 0;
        let calls = parseInt(document.getElementById('numCalls').value) || 0;
        let pv = parseInt(document.getElementById('numPV').value) || 0;
        let checks = document.querySelectorAll('.styled-checkbox:checked').length;
        
        let score = (checks * 4) + Math.min(plans * 5, 20) + Math.min(calls * 2, 10) + Math.min(pv / 100, 18);
        if(score > 100) score = 100;

        document.getElementById('scoreDisplay').innerText = `GASES Score: ${Math.round(score)}/100`;

        let legBGrowth = (parseFloat(document.getElementById('legBToday').value)||0) - (parseFloat(document.getElementById('legBYest').value)||0);
        let html = `<div style="margin-bottom:15px;"><strong>üìâ Business Trend:</strong><br>`;
        if(legBGrowth > 0) html += `<span style="color:green">Great! Leg B grew by ${legBGrowth} PV.</span>`;
        else if(legBGrowth < 0) html += `<span style="color:red">Alert: Leg B dropped by ${Math.abs(legBGrowth)} PV.</span>`;
        else html += `<span style="color:orange">Stagnant. No movement in Leg B today.</span>`;
        html += `</div>`;

        html += `<div style="margin-bottom:15px;"><strong>‚ö° Core Activities:</strong><br>`;
        if(plans >= 2) html += `‚úÖ Plan Show: Excellent (${plans}).<br>`;
        else html += `‚ùå Plan Show: Weak (${plans}). No Plan = No Growth.<br>`;
        
        if(document.getElementById('e_book').checked) html += `‚úÖ Mindset: Book reading done.<br>`;
        else html += `‚ö†Ô∏è Mindset: Book reading missing.<br>`;
        html += `</div>`;

        document.getElementById('detailedReport').innerHTML = html;
        document.getElementById('resultArea').style.display = 'block';
        return {score, report: document.getElementById('detailedReport').innerText};
    }

    function shareToWhatsApp() {
        let res = generateDetailedReport();
        let date = document.getElementById('reportDate').value;
        let text = `üáÆüá≥ *GASES Gurumantra Report* (${date})%0aüèÜ Score: ${Math.round(res.score)}/100%0aüìù ${res.report.replace(/\n/g, '%0a').substring(0, 400)}`;
        window.open(`https://wa.me/?text=${text}`, '_blank');
    }

    function downloadPDF() {
        generateDetailedReport();
        const element = document.getElementById('reportContent');
        const opt = { margin: 0.2, filename: `RCM_GASES_Report.pdf`, image: { type: 'jpeg', quality: 0.98 }, html2canvas: { scale: 2 }, jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' } };
        html2pdf().set(opt).from(element).save();
    }
</script>

</body>
</html>
